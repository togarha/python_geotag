<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Geotag - Photo Geotagging Application</title>
    <link rel="stylesheet" href="/static/styles.css">
    <!-- Leaflet CSS for OpenStreetMap -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Leaflet JS for OpenStreetMap -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Google Maps -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY"></script>
</head>
<body>
    <!-- Expandable Side Menu -->
    <div id="menu-container">
        <button id="menu-toggle" class="menu-toggle">‚ò∞</button>
        <nav id="side-menu" class="side-menu">
            <div class="menu-header">
                <h2>Menu</h2>
            </div>
            <ul class="menu-items">
                <li><a href="#" data-view="thumbnails" class="menu-link active">üì∑ Photo Thumbnails</a></li>
                <li><a href="#" data-view="gpx" class="menu-link">üó∫Ô∏è GPX View</a></li>
                <li><a href="#" data-view="positions" class="menu-link">üìç Positions View</a></li>
                <li><a href="#" data-view="settings" class="menu-link">‚öôÔ∏è Settings</a></li>
            </ul>
        </nav>
    </div>

    <!-- Main Content Area -->
    <div id="main-content" class="main-content">
        
        <!-- Folder Photo Thumbnails View -->
        <div id="thumbnails-view" class="view-container active">
            <div class="toolbar">
                <div class="toolbar-group">
                    <input type="text" id="folder-path-input" class="folder-path-input" placeholder="Enter folder path (e.g., C:\Pictures)">
                    <button id="load-folder-btn" class="btn btn-primary">üìÅ Load Folder</button>
                </div>
                <div class="toolbar-group">
                    <label>
                        <input type="checkbox" id="recursive-checkbox"> Include subfolders
                    </label>
                </div>
            </div>

            <div class="controls-bar">
                <div class="control-group">
                    <label for="map-provider">Map:</label>
                    <select id="map-provider">
                        <option value="osm">OpenStreetMap</option>
                        <option value="google">Google Maps</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="elevation-service">Elevation API:</label>
                    <select id="elevation-service">
                        <option value="open-elevation">Open-Elevation</option>
                        <option value="opentopodata">OpenTopoData</option>
                        <option value="google">Google Maps</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="sort-select">Sort by:</label>
                    <select id="sort-select">
                        <option value="time">Capture Time</option>
                        <option value="name">Name</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="filter-select">Show:</label>
                    <select id="filter-select">
                        <option value="all">All Photos</option>
                        <option value="tagged">Tagged Only</option>
                        <option value="untagged">Untagged Only</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="thumbnail-size">Thumbnail Size:</label>
                    <input type="range" id="thumbnail-size" min="100" max="400" value="200" step="50">
                    <span id="size-value">200px</span>
                </div>
            </div>

            <div class="content-split">
                <div class="photo-list-panel">
                    <h3>Photo List</h3>
                    <div id="photo-list" class="photo-list"></div>
                </div>
                <div class="photo-grid-panel">
                    <h3>Photo Grid</h3>
                    <div id="photo-grid" class="photo-grid"></div>
                </div>
            </div>
        </div>

        <!-- GPX View -->
        <div id="gpx-view" class="view-container">
            <div class="toolbar">
                <label for="gpx-upload" class="btn btn-primary">üìÇ Select GPX Files</label>
                <input type="file" id="gpx-upload" accept=".gpx" multiple style="display: none;">
                <div class="control-group" style="margin-left: 16px;">
                    <label for="gpx-main-offset">Time Offset:</label>
                    <input type="text" id="gpx-main-offset" value="+00:00:00" placeholder="¬±hh:mm:ss">
                    <button id="apply-main-offset" class="btn btn-secondary" title="Apply to all tracks">‚úì</button>
                </div>
                <div class="control-group" style="margin-left: auto;">
                    <label for="gpx-map-provider">Map:</label>
                    <select id="gpx-map-provider">
                        <option value="osm">OpenStreetMap</option>
                        <option value="google">Google Maps</option>
                    </select>
                </div>
            </div>
            <div id="gpx-map" class="gpx-map"></div>
            <div id="gpx-info" class="gpx-info">
                <h3>Loaded Tracks</h3>
                <div id="gpx-files-container" class="gpx-files-container"></div>
            </div>
        </div>

        <!-- Positions View -->
        <div id="positions-view" class="view-container">
            <div class="toolbar">
                <label for="positions-upload" class="btn btn-primary">üìÇ Select YAML Files</label>
                <input type="file" id="positions-upload" accept=".yaml,.yml" multiple style="display: none;">
            </div>
            <div id="positions-info" class="positions-info">
                <h3>Loaded Positions</h3>
                <div id="positions-container" class="positions-container"></div>
            </div>
        </div>

        <!-- Settings View -->
        <div id="settings-view" class="view-container">
            <div class="settings-container">
                <h2>Settings</h2>
                
                <div class="settings-section">
                    <h3>Photo Renaming</h3>
                    <div class="setting-item">
                        <label for="filename-format">Filename Format:</label>
                        <input type="text" id="filename-format" value="%Y%m%d_%H%M%S" class="format-input">
                        <button id="apply-format" class="btn btn-primary">Apply Format</button>
                        <button id="preview-names" class="btn btn-secondary">Preview Names</button>
                    </div>
                    <details class="format-help">
                        <summary><strong>Format Codes and Examples</strong></summary>
                        <div class="format-help-content">
                            <strong>Available Format Codes:</strong>
                            <ul>
                                <li><code>%Y</code> - Year (4 digits, e.g., 2026)</li>
                                <li><code>%m</code> - Month (01-12)</li>
                                <li><code>%d</code> - Day (01-31)</li>
                                <li><code>%H</code> - Hour 24h (00-23)</li>
                                <li><code>%M</code> - Minute (00-59)</li>
                                <li><code>%S</code> - Second (00-59)</li>
                                <li><code>%I</code> - Hour 12h (01-12)</li>
                                <li><code>%p</code> - AM/PM</li>
                            </ul>
                            <p><strong>Note:</strong> If EXIF capture time is not available, file creation time will be used.</p>
                            <p><strong>Example:</strong> <code>%Y%m%d_%H%M%S</code> ‚Üí <code>20260123_143052.jpg</code></p>
                        </div>
                    </details>
                    <div id="preview-results" class="preview-results"></div>
                </div>
                
                <div class="settings-section">
                    <h3>Photo Title</h3>
                    <div class="setting-item">
                        <label for="photo-title">Set Title for All Photos:</label>
                        <input type="text" id="photo-title" placeholder="Enter title for all photos" class="format-input">
                        <button id="apply-title" class="btn btn-primary">Apply to All</button>
                        <button id="apply-title-tagged" class="btn btn-success">Apply to Tagged</button>
                        <button id="clear-title" class="btn btn-secondary">Clear All Titles</button>
                    </div>
                    <p class="help-text">This will set the new_title field for all photos in the current folder.</p>
                </div>
            </div>
        </div>

        <!-- Large Photo View (Modal) -->
        <div id="large-photo-modal" class="modal">
            <div class="modal-content large-photo-content">
                <button class="close-modal">&times;</button>
                
                <div class="photo-view-split">
                    <div class="photo-display-section">
                        <button class="nav-btn prev-btn" id="prev-photo">‚Äπ</button>
                        <div class="photo-container">
                            <img id="large-photo-img" src="" alt="Photo">
                            <div class="photo-checkbox-overlay">
                                <input type="checkbox" id="large-photo-tag">
                            </div>
                        </div>
                        <button class="nav-btn next-btn" id="next-photo">‚Ä∫</button>
                        
                        <!-- EXIF Information below photo -->
                        <div class="exif-info-panel">
                            <div class="exif-header">
                                <h3>Photo Information</h3>
                                <button id="edit-photo-metadata" class="btn btn-primary btn-sm" disabled>‚úèÔ∏è Edit Time & Title</button>
                            </div>
                            <table class="exif-table">
                                <thead>
                                    <tr>
                                        <th>Property</th>
                                        <th>Current Value</th>
                                        <th>New Value</th>
                                    </tr>
                                </thead>
                                <tbody id="exif-info">
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="photo-info-section">
                        <div class="map-panel">
                            <h3>Location Map</h3>
                            <div id="photo-map" class="photo-map"></div>
                            <div class="map-controls">
                                <button id="copy-from-previous" class="btn btn-secondary" disabled title="Copy position from previous image">
                                    üìã
                                </button>
                                <button id="set-manual-position" class="btn btn-primary" disabled title="Set Manual Position">
                                    ‚úèÔ∏è
                                </button>
                                <button id="set-predefined-position" class="btn btn-success" disabled title="Set Predefined Position">
                                    üìç
                                </button>
                                <button id="delete-manual-marker" class="btn btn-danger" disabled title="Delete Manual Marker">
                                    üóëÔ∏è
                                </button>
                            </div>
                            <div id="marker-info" class="marker-info">
                                <div class="marker-label exif-marker">üî¥ EXIF: <span id="exif-coords">--</span></div>
                                <div class="marker-label gpx-marker">üîµ GPX: <span id="gpx-coords">--</span></div>
                                <div class="marker-label manual-marker">üü° Manual: <span id="manual-coords">--</span></div>
                                <div class="marker-label final-marker">üü¢ Final: <span id="final-coords">--</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Predefined Positions Selection Modal -->
    <div id="positions-modal" class="modal">
        <div class="modal-content positions-modal-content">
            <div class="modal-header">
                <h3>Select Predefined Position</h3>
                <button class="close-modal" id="close-positions-modal">&times;</button>
            </div>
            <div class="positions-modal-body">
                <div id="positions-list" class="positions-selection-list"></div>
            </div>
        </div>
    </div>

    <!-- Edit Photo Metadata Modal -->
    <div id="edit-metadata-modal" class="modal">
        <div class="modal-content edit-metadata-modal-content">
            <div class="modal-header">
                <h3>Edit Photo Metadata</h3>
                <button class="close-modal" id="close-edit-metadata-modal">&times;</button>
            </div>
            <div class="edit-metadata-body">
                <div class="form-group">
                    <label for="edit-photo-title-input">Photo Title:</label>
                    <div class="form-group-inline">
                        <input type="text" id="edit-photo-title-input" class="form-control" placeholder="Enter photo title">
                        <button id="apply-title-btn" class="btn btn-primary btn-inline">Apply</button>
                    </div>
                    <small class="form-help">Leave empty to clear title</small>
                </div>
                <div class="form-group">
                    <label for="edit-photo-time-input">Photo Date/Time:</label>
                    <div class="form-group-inline">
                        <input type="datetime-local" id="edit-photo-time-input" class="form-control" step="1">
                        <button id="apply-time-btn" class="btn btn-primary btn-inline">Apply</button>
                    </div>
                    <small class="form-help">Clear to remove custom time</small>
                </div>
                <div class="modal-actions">
                    <button id="close-metadata-modal-btn" class="btn btn-secondary">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
